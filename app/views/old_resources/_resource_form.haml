= simple_nested_form_for(resource, :html => {:data => {:role => 'resource-form'}, :multipart => true}) do |f|
  = f.input :lock_version, as: :hidden

  = render 'resources/resource_form_preamble'

  = f.input :title, wrapper_html: {data: {role: 'title'}}, error_html: {data: {role: 'error'}}
  = f.input :description
  - if current_user.can_change_link?(resource)
    = f.input :url, label: 'Resource on the web to link to (this must be a URL beginning with http)', wrapper_html: {data: {role: "link-field"}}, error_html: {data: {role: "error"}}
    %div.hide{data: {role: 'upload-field'}}
      %p
        Uploading a file will set the URL link to the uploaded file, replacing the current link.
      = f.input :file, as: :file, label: 'Upload a file (image, document or archive)'
      %button{data: {role: "clear-file"}, class: 'btn'} Clear file
    %button.btn.btn-info{data: {role: "toggle-field"}} Upload a file instead

  - else
    .control-group
      = f.label :url, class: 'control-label string'
      .controls
        %input.string#resource_url{type: 'text', value: resource.url, disabled: true}
        %br
        .instruction.change-note
          = "This resource asset may only be changed by this resource's creator (#{resource.user.name}) or by an administrator."
  %br
  %br
  %br
  = f.label 'Optionally add the resource to one or more pages (you can also do this later if you want to)'
  = f.fields_for :resource_usages do |title_form|
    .parent-div.width-400px
      .float-left
        = title_form.input :page_title, as: :autocomplete, url: autocomplete_page_title_resources_path, label: false
      .float-right
        = title_form.link_to_remove fa_icon('times'), class: 'btn btn-mini btn-error red'
  = f.link_to_add "Add a page", :resource_usages, class: 'btn'
  %br
  %br
  %br
  = f.button :submit, class: 'btn btn-primary'
